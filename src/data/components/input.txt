<script lang="ts" setup>
// Types
import type { I<%camel%>InputExpose, I<%camel%>InputProps } from '<%typesImport%>/components/input';

// Vue
import { ref, computed, toRef, useTemplateRef } from 'vue';

// Composables
import { useClassList } from '<%composablesImport%>/class-list';
import { useDeviceProperties } from '<%composablesImport%>/device-is';

const props = withDefaults(defineProps<I<%camel%>InputProps>(), {
    value: undefined,
    modelValue: undefined,
    inputName: 'input',
});

const emit = defineEmits<{
    input: [value: string];
    change: [value: string];
    focus: [value: FocusEvent];
    blur: [value: FocusEvent];
    'update:modelValue': [value: string];
    keydown: [value: KeyboardEvent];
    keyup: [value: KeyboardEvent];
    click: [value: PointerEvent];
}>();

// Refs
const container = useTemplateRef('container');
const input = useTemplateRef('input');

// Data
const isFocused = ref<boolean>(false);

// Computed
const currentValue = computed(() => props.value ?? props.modelValue);

// Composables
const $properties = useDeviceProperties(
    {
        size: toRef(() => props.size),
        color: toRef(() => props.color),
        radius: toRef(() => props.radius),
    },
    toRef(() => props.devices),
);

const $classList = useClassList(
    {
        size: $properties.size,
        color: $properties.color,
        radius: $properties.radius,
        focused: isFocused,
        disabled: toRef(() => props.disabled),
        invalid: toRef(() => props.invalid),
        fluid: toRef(() => props.fluid),
    },
    'input',
);

// Methods
function onLabelMousedown(event: Event) {
    if (isFocused.value) event.preventDefault();
}

function onInput(event: Event): void {
    event.stopPropagation();
    const target = event.target as HTMLInputElement;

    emit('update:modelValue', target.value);
    emit('input', target.value);
}

function onChange(event: Event): void {
    event.stopPropagation();
    const target = event.target as HTMLInputElement;

    emit('change', target.value);
}

function onFocus(event: FocusEvent) {
    emit('focus', event);
    isFocused.value = true;
}

function onBlur(event: FocusEvent) {
    emit('blur', event);
    isFocused.value = false;
}

function onClick(event: PointerEvent) {
    emit('click', event);
}

function onKeydown(event: KeyboardEvent) {
    emit('keydown', event);
}

function onKeyup(event: KeyboardEvent) {
    emit('keyup', event);
}

// Exports
defineExpose<I<%camel%>InputExpose>({
    element: container,
    input: input,
});
</script>

<template>
    <label
        ref="container"
        :class="['<%kebab%>-input', $classList]"
        @mousedown="onLabelMousedown"
    >
        <slot name="prepend"></slot>

        <div
            v-if="$slots.preicon"
            class="<%kebab%>-input-icon <%kebab%>-input-icon_left"
        >
            <slot name="preicon" />
        </div>

        <div class="<%kebab%>-input-wrapper">
            <slot name="label" />

            <input
                ref="input"
                class="<%kebab%>-input-target"
                :value="currentValue"
                :type="type"
                :name="inputName"
                :placeholder="placeholder"
                :readonly="readonly"
                :step="step"
                :min="min"
                :max="max"
                :maxlength="maxlength"
                :tabindex="tabindex"
                :disabled="disabled"
                @input="onInput"
                @change="onChange"
                @focus="onFocus"
                @blur="onBlur"
                @keydown="onKeydown"
                @keyup="onKeyup"
                @click="onClick"
            />
        </div>

        <div
            v-if="$slots.icon"
            class="<%kebab%>-input-icon <%kebab%>-input-icon_right"
        >
            <slot name="icon" />
        </div>

        <slot name="append" />
    </label>
</template>

<style>
.<%kebab%>-input {
    display: flex;
    align-items: center;
    flex-wrap: nowrap;
    border-style: solid;
    cursor: text;

    /* --- <%camel%>Input - Color --- */
    color: var(--<%kebab%>-input-color-text, inherit);
    background-color: var(--<%kebab%>-input-color-background, transparent);
    border-color: var(--<%kebab%>-input-color-border, transparent);
    outline-color: var(--<%kebab%>-input-color-outline, initial);

    /* --- <%camel%>Input - Size --- */
    padding: var(--<%kebab%>-input-size-padding, 0);
    gap: var(--<%kebab%>-input-size-gap, 0.8em);
    font-size: var(--<%kebab%>-input-size-text, inherit);
    font-weight: var(--<%kebab%>-input-size-text-weight, 400);
    line-height: var(--<%kebab%>-input-size-text-height, 1);
    border-width: var(--<%kebab%>-input-size-border, 0);
    outline-width: var(--<%kebab%>-input-size-outline, initial);
    outline-offset: var(--<%kebab%>-input-size-outline-offset, initial);

    /* --- <%camel%>Input - Radius --- */
    border-radius: var(--<%kebab%>-input-radius-value, 0);

    /* --- <%camel%>Input - Transition --- */
    transition:
        color var(--<%kebab%>-input-transition-duration, 0.2s) var(--<%kebab%>-input-transition-function, ease),
        background-color var(--<%kebab%>-input-transition-duration, 0.2s)
            var(--<%kebab%>-input-transition-function, ease),
        border-color var(--<%kebab%>-input-transition-duration, 0.2s)
            var(--<%kebab%>-input-transition-function, ease);
}

/* --- Focused --- */
.<%kebab%>-input:has(.<%kebab%>-input-target:focus-visible) {
    outline-style: auto;
}

/* --- Disabled --- */
._input-disabled .<%kebab%>-input-target {
    cursor: default;
}

/* --- Fluid --- */
.<%kebab%>-input._input-fluid {
    width: 100%;
}

.<%kebab%>-input-wrapper {
    display: flex;
    flex-direction: column;
}

.<%kebab%>-input-target {
    outline: none;
    padding: 0;
    border: none;
    font-family: inherit;
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
    width: 100%;
    font-size: inherit;
    cursor: inherit;

    /* --- <%camel%>Input - Color --- */
    color: inherit;
    background-color: transparent;
    caret-color: var(--<%kebab%>-input-color-caret, currentColor);

    /* --- <%camel%>Input - Size --- */
    height: var(--<%kebab%>-input-size-height, auto);
}

.<%kebab%>-input-target::placeholder {
    font-weight: var(--<%kebab%>-input-size-placeholder-weight, inherit);
    color: var(--<%kebab%>-input-color-placeholder, initial);
}

.<%kebab%>-input-target[type='number']::-webkit-inner-spin-button,
.<%kebab%>-input-target[type='number']::-webkit-outer-spin-button {
    -webkit-appearance: none;
    margin: 0;
}

.<%kebab%>-input-target[disabled] {
    opacity: 1;
}

.<%kebab%>-input-target::-ms-clear {
    display: none;
}

.<%kebab%>-input-icon {
    flex-shrink: 0;
    pointer-events: none;
    font-size: inherit;

    /* --- <%camel%>Input - Color --- */
    color: var(--<%kebab%>-input-color-icon, initial);
    fill: var(--<%kebab%>-input-color-icon, initial);

    /* --- <%camel%>Input - Size --- */
    width: var(--<%kebab%>-input-size-icon, auto);
}
</style>